name: Fineract Gradle build - basicauth
on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-20.04
    env:
        TZ: Asia/Kolkata
    steps:
      - name: Set up cache
        uses: actions/cache@v3
        with:
          path: |
            ~/.gradle/caches
            ~/.gradle/wrapper
          key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}
          restore-keys: |
            ${{ runner.os }}-gradle-
      - name: Checkout
        uses: actions/checkout@v3
      - name: Set up JDK 17
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'zulu'
      - name: Validate Gradle wrapper
        uses: gradle/wrapper-validation-action@859c33240bd026ce8d5f711f5adcc65c2f8eafc1
      - name: Install additional software
        run: |
            sudo apt-get update
            sudo apt-get install ghostscript -y
      - name: Basic Auth Build & Test
        # TODO: enable this before merging back to develop
        # run: ./gradlew --no-daemon -q --console=plain licenseMain licenseTest check build test --fail-fast doc -x :twofactor-tests:test -x :oauth2-test:test
        run: ./gradlew --no-daemon -q --console=plain licenseMain licenseTest check build test doc -x :twofactor-tests:test -x :oauth2-test:test
      - name: 2FA Build & Test
        run: ./gradlew --no-daemon -q --console=plain :twofactor-tests:test --fail-fast
      - name: OAuth2 Build & Test
        run: ./gradlew --no-daemon -q --console=plain :oauth2-tests:test --fail-fast